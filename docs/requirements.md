# 糖質管理アドバイザー - 要件定義書

## 1. プロジェクト概要

日々の食事画像から栄養素を推定し、糖質制限が必要な方の食生活をサポートするWebアプリケーション。

## 2. 基本仕様

| 項目 | 内容 |
|------|------|
| プラットフォーム | Webアプリ（レスポンシブ対応） |
| 画像認識API | Google Gemini |
| ユーザー管理 | 複数ユーザー対応（認証あり） |
| 運用環境 | クラウド（Vercel + Railway + Supabase） |
| 食事記録単位 | 朝・昼・夕の3食 |

## 3. 技術スタック

### バックエンド
- Python 3.11+
- FastAPI
- Google Gemini API
- PostgreSQL（Supabase）

### フロントエンド
- Next.js 14 (App Router)
- React 18
- Tailwind CSS
- Chart.js（レーダーチャート）

### インフラ
- フロントエンド: Vercel
- バックエンド: Railway または Render
- DB・認証・ストレージ: Supabase

## 4. 機能要件

### 4.1 コア機能（Phase 1）✅ 完了
- [x] 食事画像のアップロード
- [x] Gemini AIによる食品認識
- [x] 栄養素推定（糖質・たんぱく質・脂質・食物繊維・カロリー・塩分）
- [x] 分析結果のテキスト表示
- [x] 食べる順番のアドバイス表示

### 4.2 比較・可視化機能（Phase 2）✅ 完了
- [x] 医師推奨基準値の設定（医師データ反映済み）
- [x] レーダーチャートによる基準値との比較
- [x] 摂取状況のカラー表示（良好/注意/警告）
- [x] 医師データに基づくアドバイス表示
- [x] ベジファースト（食べる順番）ガイド
- [x] ご飯の量の目安表示（おにぎり換算）

### 4.3 ユーザー認証・データ保存（Phase 3）
- [ ] Supabaseセットアップ
- [ ] ユーザー登録・ログイン機能
- [ ] 食事記録の保存（画像 + 栄養データ）
- [ ] ユーザーごとのデータ分離

### 4.4 検索・レポート機能（Phase 4）
- [ ] 日付・キーワードによる食事検索
- [ ] 週間サマリーレポート
- [ ] 月間トレンドグラフ
- [ ] 目標達成率の表示

## 5. 栄養摂取基準値（医師データ反映済み）

**出典**: 医師提供資料「できることから始めよう 健康増進サポート」

### 5.1 1食あたりの目安

| 項目 | 目安 | 視覚的ガイド | 備考 |
|------|------|--------------|------|
| 主食（糖質） | 40-55g | 握りこぶし（ご飯約150g） | 遅い時間帯は減らす |
| 主菜（たんぱく質） | 15-25g | 指を含まない片手のひら | 大豆製品は2倍量OK |
| 副菜（野菜） | 120-150g | - | 1/3緑黄色、2/3淡色野菜 |
| 脂質 | 10-20g | - | 脂身・皮を除くとカロリーカット |
| 食物繊維 | 6-8g | - | |
| 塩分 | 2g以下 | - | 1日6g未満 |

### 5.2 1日あたりの目安

| 項目 | 目安 | 備考 |
|------|------|------|
| カロリー | 1400-2000kcal | 活動量により調整 |
| 糖質 | 130-165g | 主食は握りこぶし×3食分 |
| たんぱく質 | 50-75g | 片手のひら程度×3食分 |
| 野菜 | 350-400g | 数値高めの方は多めに |
| 塩分 | 6g未満 | |
| 果物 | 握りこぶし1個分 | 日中に摂取 |
| お菓子 | 100kcal以内 | 15時までに |

### 5.3 食べる順番（ベジファースト）

血糖値スパイクを防ぐため、以下の順番で食べることを推奨：

1. **副菜（食物繊維）**: 野菜、サラダ、海藻、きのこ
   - 効果: 食物繊維が糖の吸収を穏やかにし、満腹中枢を刺激

2. **主菜（たんぱく質）**: 肉、魚、卵、大豆製品
   - 効果: 血糖値の上昇を緩やかに

3. **主食（炭水化物）**: ご飯、パン、麺類
   - 効果: 最後に食べることで血糖値の急上昇を抑制

### 5.4 食事のポイント（医師推奨）

#### 炭水化物を摂る際のポイント
- 精製度の低いものを選ぶ（雑穀米など）で食後血糖値が上がりにくい
- 遅い時間帯は主食の量を減らす（脂肪になりやすい）
- 主菜・副菜に糖質が多い場合（イモ類など）は主食を減らす
- 揚げ物など脂質が多い場合も主食を減らす

#### たんぱく質を摂る際のポイント
- 3食ごとに適量摂る（まとめ食べはNG）
- 脂質の少ない部位を選ぶ（豚バラより豚ロース）
- 魚や大豆製品を組み合わせる（血栓リスク低減）
- 脂身や皮を除くとカロリーカット

#### 食事のタイミング
- 1日3食規則正しく（欠食は血糖値スパイクの原因）
- 夕食が遅くなる場合は分食を（夕方に炭水化物、遅い時間におかずのみ）
- 寝る直前は炭水化物を減らし、脂質控えめの消化の良いものを
- 果物は代謝が下がる夕方以降を避けて日中に

#### その他のポイント
- よく噛んでゆっくり食べる
- 食後10分程度の軽い運動（散歩やスクワット）で血糖上昇を抑制
- 水分は1日2リットルを目安に
- お菓子は1日100kcal以内、15時までに
- 飲み物は無糖・カロリーゼロを選択

### 5.5 ご飯の量の参考（コンビニおにぎり換算）

| 料理名 | ご飯量 | 糖質 | おにぎり換算 |
|--------|--------|------|--------------|
| コンビニおにぎり1個 | 100g | 37g | - |
| カレーライス（普通） | 300g | 111g | 3個分 |
| カレーライス（大盛） | 400g | 148g | 4個分 |
| 丼もの（普通） | 260g | 96g | 2.6個分 |
| 丼もの（大盛） | 320g | 118g | 3.2個分 |
| **推奨（握りこぶし）** | **150g** | **55g** | **1.5個分** |

## 6. 出力形式

### 6.1 テキスト出力
- 認識した食品リスト
- 各栄養素の推定値
- 推奨される食べる順番
- 糖質制限向けアドバイス

### 6.2 グラフ出力
- レーダーチャート（基準値との比較）
  - 糖質
  - たんぱく質
  - 脂質
  - 食物繊維
  - 塩分
- 基準値超過時の警告表示

## 7. データベース設計（概要）

```sql
-- ユーザー（Supabase Auth連携）
users (id, email, created_at)

-- 医師推奨基準値
nutrition_standards (
  id,
  name,                -- 基準名（例：「標準糖質制限」）
  carbs_limit,         -- 糖質上限(g)
  protein_min,         -- たんぱく質下限(g)
  protein_max,         -- たんぱく質上限(g)
  fat_limit,           -- 脂質上限(g)
  fiber_target,        -- 食物繊維目標(g)
  calories_min,        -- カロリー下限(kcal)
  calories_max,        -- カロリー上限(kcal)
  salt_limit,          -- 塩分上限(g)
  is_per_meal,         -- true: 1食あたり, false: 1日あたり
  notes                -- 備考
)

-- 食事記録
meals (
  id,
  user_id,
  meal_type,           -- breakfast/lunch/dinner
  meal_date,
  image_url,
  created_at
)

-- 栄養データ
nutrition_data (
  id,
  meal_id,
  carbs,
  protein,
  fat,
  fiber,
  calories,
  salt,
  food_items,          -- JSON: 認識した食品リスト
  advice,              -- 生成されたアドバイス
  eating_order         -- JSON: 推奨食べ順
)
```

## 8. 非機能要件

- 画像アップロード: 最大10MB
- 対応画像形式: JPEG, PNG
- 分析レスポンス: 10秒以内
- 同時アクセス: 100ユーザー程度を想定

## 9. 注意事項

- 栄養素の数値はAIによる推定値であり、正確な値ではない
- 医療上のアドバイスではなく、参考情報として提供
- 糖質制限の詳細は医師に相談することを推奨
- 基準値は医師提供資料「できることから始めよう 健康増進サポート」に基づく

## 10. 進捗状況

| Phase | 内容 | 状態 |
|-------|------|------|
| Phase 1 | コア機能（画像→栄養分析） | ✅ 完了 |
| Phase 2 | 比較・可視化機能（医師データ反映） | ✅ 完了 |
| Phase 3 | ユーザー認証・データ保存 | ⏳ 未着手 |
| Phase 4 | 検索・レポート機能 | ⏳ 未着手 |
